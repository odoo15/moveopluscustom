<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<record id="view_partner_form_mv_sale" model="ir.ui.view">
		<field name="name">view_partner_form_mv_sale</field>
		<field name="model">res.partner</field>
		<field name="inherit_id" ref="base.view_partner_form"/>
		<field name="arch" type="xml">
			<xpath expr="//notebook" position="inside">
				<page string="Chiết khấu" name="page_partner_discount_info">
					<field name="amount" invisible="True"/>
					<group>
						<group>
							<field name="is_agency"/>
							<field name="is_white_agency"/>
							<label for="bank_guarantee"/>
							<div class="o_row">
								<field name="bank_guarantee"/>
								-
								<field name="discount_bank_guarantee" invisible="not bank_guarantee"/>
							</div>
						</group>
						<group invisible="not is_agency">
							<label for="amount_currency"/>
							<div class="o_row">
								<field class="fw-bold" name="amount_currency" decoration-info="amount_currency > 0" decoration-muted="amount_currency == 0"/>
                                <button string="Cập nhật số tiền" class="btn btn-link" type="object" name="action_update_discount_amount" invisible="not is_agency"/>
                            </div>
						</group>
					</group>
					<group invisible="not is_agency">
						<group>
							<label for="discount_id"/>
							<div class="o_row">
								<field class="oe_inline" name="discount_id" required="is_agency" options="{'no_open': True}"/>
							</div>
							<label for="warranty_discount_policy_id"/>
							<div class="o_row">
								<field class="oe_inline" name="warranty_discount_policy_id" options="{'no_open': True}"/>
							</div>
						</group>
					</group>
					<field name="line_ids" nolabel="1" readonly="True" context="{'from_view_ref': 'mv_sale.mv_discount_partner_form_view'}" options="{'no_open': True, 'no_create_edit': True}" invisible="not is_agency">
						<tree decoration-warning="needs_update">
							<field name="needs_update" column_invisible="True"/>
							<field name="parent_id" column_invisible="True"/>
							<field name="warranty_discount_policy_id" column_invisible="True"/>
							<field name="date"/>
							<field name="level"/>
							<field name="min_debt"/>
							<field name="max_debt"/>
							<field name="number_debt"/>
							<button string="Cập nhật chính sách"
							        name="action_update_partner_discount"
							        type="object"
							        class="btn btn-info btn-sm"
							        groups="sales_team.group_sale_salesman"
							        confirm="Bạn muốn cập nhật chính sách cho đơn vị này?"/>
						</tree>
					</field>
				</page>
				<page string="Chiết khấu chi tiết" name="page_partner_discount_detail" invisible="not is_agency">
					<field name="compute_discount_line_ids" nolabel="1" readonly="True" options="{'no_open': True}">
						<tree default_order="id desc">
							<field name="partner_sales_state" decoration-success="partner_sales_state in ['qualified', 'qualified_by_approving']" decoration-warning="partner_sales_state == 'imqualified'" widget="badge" optional="hidden"/>
							<field name="name" string="Tháng/Năm"/>
							<field name="quantity" string="Số lượng lốp đã bán"/>
							<field name="quantity_from" optional="hidden"/>
							<field name="quantity_to" optional="hidden"/>
							<field name="amount_total" string="Doanh thu" widget="monetary" sum="Total Amount of Month"/>
							<field name="is_month" column_invisible="True"/>
							<field name="month" column_invisible="True"/>
							<field name="month_money" string="CK Tháng" widget="monetary" sum="Discount Month"/>
							<field name="is_two_month" column_invisible="True"/>
							<field name="amount_two_month" column_invisible="True"/>
							<field name="two_month" column_invisible="True"/>
							<field name="two_money" string="CK 2 Tháng" widget="monetary" sum="Discount Two Months"/>
							<field name="is_quarter" column_invisible="True"/>
							<field name="quarter" column_invisible="True"/>
							<field name="quarter_money" string="CK Quý" widget="monetary" sum="Discount quarter"/>
							<field name="is_year" column_invisible="True"/>
							<field name="year" column_invisible="True"/>
							<field name="year_money" string="CK Năm" widget="monetary" sum="Discount year"/>
							<field name="promote_discount_percentage" column_invisible="True"/>
							<field name="promote_discount_money" string="CK Khuyến Khích" widget="monetary" sum="Promote Discount"/>
							<field name="total_money" string="Tổng tiền" widget="monetary" sum="Total money"/>
							<field name="currency_id" column_invisible="True"/>
						</tree>
					</field>
				</page>
				<page string="Đơn hàng chiết khấu" name="page_partner_discount_orders" invisible="not is_agency">
					<field name="sale_mv_ids" nolabel="1" readonly="True" options="{'no_open': True}">
						<tree default_order="id desc" create="false" edit="false" delete="false">
							<field name="name" string="Đơn hàng"/>
							<field name="bonus_order" string="Tiền chiết khấu" widget="monetary" options="{'currency_field': 'currency_id'}"/>
							<field name="state" string="Trạng thái" widget="badge" decoration-info="state == 'draft'" decoration-success="state == 'sale'"/>
							<field name="currency_id" column_invisible="True"/>
						</tree>
					</field>
					<group name="total_group" col="6" class="mt-2 mt-md-0">
						<group colspan="4"/>
						<group class="oe_subtotal_footer" colspan="2" name="sale_bonus_order_total">
							<field name="total_so_bonus_order" string="Tổng tiền chiết khấu" colspan="2" readonly="True"/>
						</group>
						<div class="clearfix"/>
					</group>
				</page>
			</xpath>
		</field>
	</record>
</odoo>
